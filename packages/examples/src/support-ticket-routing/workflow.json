{
  "$schema": "https://tinnguyenhuuletrong.github.io/tiny-flow-in-json/schema/latest/flow.json",
  "id": "support-ticket-router-v2",
  "name": "Customer Support Ticket Routing Flow",
  "version": "2.0.0",
  "globalStateSchema": {
    "type": "object",
    "properties": {
      "id": {
        "type": "string"
      },
      "priority": {
        "type": "string",
        "enum": [
          "low",
          "medium",
          "high",
          "urgent"
        ]
      },
      "category": {
        "type": "string",
        "enum": [
          "technical",
          "billing",
          "general"
        ]
      },
      "isVip": {
        "type": "boolean",
        "default": false
      },
      "assignedAgentId": {
        "type": "string"
      }
    },
    "required": [
      "id",
      "priority",
      "category"
    ]
  },
  "steps": [
    {
      "id": "start-routing",
      "name": "Begin Ticket Routing",
      "type": "begin",
      "metadata": {
        "x": 12,
        "y": 88.92015011080514
      }
    },
    {
      "id": "evaluate-ticket",
      "name": "Evaluate Ticket Priority & Category",
      "type": "decision",
      "metadata": {
        "x": 412,
        "y": 57,
        "handles": [
          {
            "id": "c4-default",
            "type": "source",
            "position": "Top"
          },
          {
            "id": "c5-vip",
            "type": "source",
            "position": "Bottom"
          },
          {
            "id": "c1",
            "type": "target",
            "position": "Left"
          },
          {
            "id": "c3-billing",
            "type": "source",
            "position": "Right"
          },
          {
            "id": "c2-urgent",
            "type": "source",
            "position": "Right"
          }
        ]
      }
    },
    {
      "id": "escalate-urgent",
      "name": "Escalate to L2 Tech Support",
      "type": "task",
      "metadata": {
        "x": 809.724023603881,
        "y": 609.7240236038809
      }
    },
    {
      "id": "route-to-billing",
      "name": "Route to Billing Team",
      "type": "task",
      "metadata": {
        "x": 803.8456719733003,
        "y": 59.93185195163363
      }
    },
    {
      "id": "assign-general",
      "name": "Assign to General Support Queue",
      "type": "task",
      "metadata": {
        "x": 803.657261333017,
        "y": -71.63084602283399
      }
    },
    {
      "id": "add-vip-tag",
      "name": "Tag as VIP Customer",
      "type": "task",
      "metadata": {
        "x": 1212,
        "y": 697
      }
    },
    {
      "id": "send-confirmation",
      "name": "Send Confirmation to Customer",
      "type": "task",
      "metadata": {
        "x": 1209.2082609334052,
        "y": 221.82660717856965,
        "handles": [
          {
            "id": "c8",
            "type": "target",
            "position": "Top"
          },
          {
            "id": "c6",
            "type": "target",
            "position": "Bottom"
          },
          {
            "id": "c7",
            "type": "target",
            "position": "Left"
          },
          {
            "id": "c10",
            "type": "source",
            "position": "Right"
          }
        ]
      }
    },
    {
      "id": "end-routing",
      "name": "End Routing Process",
      "type": "end",
      "metadata": {
        "x": 1612,
        "y": 337
      }
    }
  ],
  "connections": [
    {
      "id": "c1",
      "sourceStepId": "start-routing",
      "targetStepId": "evaluate-ticket"
    },
    {
      "id": "c2-urgent",
      "sourceStepId": "evaluate-ticket",
      "targetStepId": "escalate-urgent",
      "condition": "state.ticket.priority == 'urgent' && state.ticket.category == 'technical'"
    },
    {
      "id": "c3-billing",
      "sourceStepId": "evaluate-ticket",
      "targetStepId": "route-to-billing",
      "condition": "state.ticket.category == 'billing'"
    },
    {
      "id": "c4-default",
      "sourceStepId": "evaluate-ticket",
      "targetStepId": "assign-general"
    },
    {
      "id": "c5-vip",
      "sourceStepId": "evaluate-ticket",
      "targetStepId": "add-vip-tag",
      "condition": "state.ticket.isVip == true"
    },
    {
      "id": "c6",
      "sourceStepId": "escalate-urgent",
      "targetStepId": "send-confirmation"
    },
    {
      "id": "c7",
      "sourceStepId": "route-to-billing",
      "targetStepId": "send-confirmation"
    },
    {
      "id": "c8",
      "sourceStepId": "assign-general",
      "targetStepId": "send-confirmation"
    },
    {
      "id": "c9",
      "sourceStepId": "add-vip-tag",
      "targetStepId": "end-routing"
    },
    {
      "id": "c10",
      "sourceStepId": "send-confirmation",
      "targetStepId": "end-routing"
    }
  ]
}